<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <title>Minas Overview</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2216%22>ðŸ¦„</text></svg>">
  <!-- QRCode.js -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    /* Reset and body */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', sans-serif;
      background: #121212;
      color: #eee;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: 2rem;
      color: #4ecdc4;
      text-align: center;
    }

    /* Grid */
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      width: 100%;
      max-width: 1200px;
      justify-content: center;
    }

    /* Card */
    .card {
      display: flex;
      flex-direction: row;
      background: #1e1e1e;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0,0,0,0.4);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
      width: calc(33% - 1rem); /* 1/3 width minus gap */
      min-height: 180px;
      max-height: 220px;
    }

    .card:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 20px rgba(78, 205, 196, 0.5);
    }

    /* Thumbnail */
    .thumb {
      flex: 0 0 120px;
      background: #2a2a2a;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Content (middle + right QR) */
    .content {
      flex: 1;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: stretch;
      padding: 0.8rem;
    }

    .info {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }

    .gallery-name {
      text-transform: capitalize;
      font-size: 1.2rem;
      font-weight: 600;
      color: #ff79c6;
      margin-bottom: auto;
    }

    /* QR code container */
    .qr {
      flex: 0 0 80px;
      margin-left: 0.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #1e1e1e;
    }

    .qr canvas {
      width: 100% !important;
      height: 100% !important;
    }

    /* Responsive for mobile */
    @media (max-width: 900px) {
      .card {
        width: calc(50% - 1rem); /* 2 per row */
      }
    }
    @media (max-width: 600px) {
      .card {
        flex-direction: column;
        width: 100%;
        min-height: auto;
      }
      .thumb {
        width: 100%;
        height: 180px;
      }
      .content {
        flex-direction: row;
        padding: 0.5rem;
      }
      .qr {
        flex: 0 0 60px;
      }
    }
  </style>
</head>
<body>
<h1>Minas Galleries</h1>
<div class="grid" id="dir-list"></div>

<script>
  const user = "sebastianneubert";
  const repo = "minas-slideshow";
  const branch = "main"; // or master
  const path  = "";      // root relative to repo

    async function fetchJson(url) {
      const res = await fetch(url);
      return res.json();
    }

    async function loadDirs() {
      const url = `https://api.github.com/repos/${user}/${repo}/contents/${path}?ref=${branch}`;
      const data = await fetchJson(url);

      const grid = document.getElementById("dir-list");

      for (const item of data) {
        if (item.type === "dir") {
          const imgApiUrl = `https://api.github.com/repos/${user}/${repo}/contents/${item.path}/images?ref=${branch}`;
          let imgUrl = "https://via.placeholder.com/120x180.png?text=No+Image";

          try {
            const files = await fetchJson(imgApiUrl);
            const firstImg = files.find(f => f.type === "file" && f.name.match(/\.(jpg|jpeg|png|gif|webp)$/i));
            if (firstImg) {
              imgUrl = `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${item.path}/images/${firstImg.name}`;
            }
          } catch(e) {
            console.log("No images folder in", item.name);
          }

          const card = document.createElement("a");
          card.href = `./${item.name}/`;
          card.className = "card";

          card.innerHTML = `
            <div class="thumb">
              <img src="${imgUrl}" alt="${item.name}">
            </div>
            <div class="content">
              <div class="info">
                <div class="gallery-name">${item.name}</div>
                <div class="qr" id="qr-${item.name}"></div>
              </div>
            </div>
          `;

          grid.appendChild(card);

          // QR code full height
          new QRCode(document.getElementById(`qr-${item.name}`), {
            text: `${window.location.href}${item.name}/`,
            width: 120,
            height: 120,
            colorDark : "#eee",
            colorLight : "#1e1e1e",
            correctLevel : QRCode.CorrectLevel.H
          });
        }
      }
    }

    loadDirs();
</script>
</body>
</html>
